const PARENT_MODULE_BASE="form",MODULE_BASE="input-calendar",ATTRIBUTE_BASE="data-w-"+MODULE_BASE,ATTRIBUTE_BASE_ID=ATTRIBUTE_BASE+"-id",ATTRIBUTE_INPUT=ATTRIBUTE_BASE+"-input",ATTRIBUTE_INPUT_FORMATTED=ATTRIBUTE_INPUT+"-formatted",ATTRIBUTE_CONTROL=ATTRIBUTE_BASE+"-control",ATTRIBUTE_ACTION=ATTRIBUTE_BASE+"-action",ATTRIBUTE_ACTION_ARGS=ATTRIBUTE_ACTION+"-args",ATTRIBUTE_ACTION_FLUSH=ATTRIBUTE_ACTION+"-flush",ATTRIBUTE_TABLE=ATTRIBUTE_BASE+"-table",ATTRIBUTE_HEAD=ATTRIBUTE_BASE+"-head",EVENT_CHANGE_DATE_AFTER=`welpodron.${PARENT_MODULE_BASE}.${MODULE_BASE}:changeDate:after`;class CalendarHead{calendar;constructor({calendar:e}){this.calendar=e}render=()=>{var e=document.createElement("div");e.setAttribute(ATTRIBUTE_HEAD,"");let t=document.createElement("button");var a=new Date(this.calendar.activeDate.getFullYear(),this.calendar.activeDate.getMonth(),1),a=(a.setDate(a.getDate()-1),t.innerText="<",t.setAttribute("type","button"),this.calendar.currentDate.getTime()>a.getTime()?t.setAttribute("disabled",""):(t.setAttribute(ATTRIBUTE_ACTION_ARGS,"-1"),t.setAttribute(ATTRIBUTE_ACTION,"changeMonth"),t.setAttribute(ATTRIBUTE_CONTROL,""),t.setAttribute(ATTRIBUTE_BASE_ID,this.calendar.el.getAttribute(""+ATTRIBUTE_BASE_ID))),e.appendChild(t),document.createElement("p"));let n=document.createElement("span");return n.innerText=this.calendar.activeDate.toLocaleString("ru-RU",{month:"long"}),a.appendChild(n),(n=document.createElement("span")).innerText=this.calendar.activeDate.getFullYear().toString(),a.appendChild(n),e.appendChild(a),(t=document.createElement("button")).setAttribute("type","button"),t.setAttribute(ATTRIBUTE_ACTION_ARGS,"1"),t.setAttribute(ATTRIBUTE_ACTION,"changeMonth"),t.setAttribute(ATTRIBUTE_CONTROL,""),t.setAttribute(ATTRIBUTE_BASE_ID,this.calendar.element.getAttribute(""+ATTRIBUTE_BASE_ID)),t.innerText=">",e.appendChild(t),e}}class CalendarTable{calendar;constructor({calendar:e}){this.calendar=e}render=()=>{var e=document.createElement("table"),t=(e.setAttribute(ATTRIBUTE_TABLE,""),document.createElement("thead"));const a=document.createElement("tr"),n=(["Пн","Вт","Ср","Чт","Пт","Сб","Вс"].forEach(e=>{var t=document.createElement("th");t.innerText=e,a.appendChild(t)}),t.appendChild(a),e.appendChild(t),document.createElement("tbody"));return this.calendar.getPanel({year:this.calendar.activeDate.getFullYear(),month:this.calendar.activeDate.getMonth()}).forEach(e=>{const r=document.createElement("tr");e.forEach(e=>{var t,a=document.createElement("td"),n=e.getDate()<10?"0"+e.getDate():e.getDate().toString(),T=e.getMonth()+1<10?"0"+(e.getMonth()+1):(e.getMonth()+1).toString();this.calendar.activeDate.getMonth()===e.getMonth()&&(t=document.createElement("button"),this.calendar.currentDate.getTime()>e.getTime()?t.setAttribute("disabled",""):(t.setAttribute(ATTRIBUTE_ACTION_ARGS,e.getFullYear()+`-${T}-`+n),t.setAttribute(ATTRIBUTE_ACTION,"changeDate"),t.setAttribute(ATTRIBUTE_CONTROL,""),t.setAttribute(ATTRIBUTE_BASE_ID,this.calendar.element.getAttribute(""+ATTRIBUTE_BASE_ID))),t.setAttribute("type","button"),t.innerText=n,a.appendChild(t)),r.appendChild(a)}),n.appendChild(r)}),e.appendChild(n),e}}class Calendar{element;head;table;spAc=["changeMonth","changeDate"];currentDate;savedDate=null;activeDate;constructor({element:e}){var t=new Date;t.setHours(0,0,0,0),this.currentDate=t,this.activeDate=new Date(t),this.el=e,this.head=new CalendarHead({calendar:this}),this.table=new CalendarTable({calendar:this}),this.el.appendChild(this.head.render()),this.el.appendChild(this.table.render()),document.removeEventListener("click",this.hDC),document.addEventListener("click",this.hDC)}hDC=e=>{let t=e["target"];var a,n;if(t&&(t=t.closest(`[${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"][${ATTRIBUTE_CONTROL}][${ATTRIBUTE_ACTION}]`)))return n=t.getAttribute(ATTRIBUTE_ACTION),a=t.getAttribute(ATTRIBUTE_ACTION_ARGS),t.getAttribute(ATTRIBUTE_ACTION_FLUSH)||e.preventDefault(),n&&this.spAc.includes(n)&&(n=this[n])instanceof Function?n({args:a,event:e}):void 0};changeMonth=async({args:e})=>{if(this.activeDate.setMonth(this.activeDate.getMonth()+parseInt(e)),"function"==typeof this.el.replaceChildren)return this.el.replaceChildren(this.head.render(),this.table.render());this.el.innerHTML="",this.el.appendChild(this.head.render()),this.el.appendChild(this.table.render())};changeDate=async({args:a})=>{var e=a.split("-").map(e=>parseInt(e)).filter(e=>!isNaN(e)),[t,n,T]=e,e=(e.length<3?this.savedDate=null:this.savedDate=new Date(t,n-1,T),new CustomEvent(EVENT_CHANGE_DATE_AFTER,{bubbles:!0,cancelable:!1,detail:{date:this.savedDate?new Date(this.savedDate):null}}));this.el.dispatchEvent(e),document.querySelectorAll(`[${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"][${ATTRIBUTE_INPUT}]`).forEach(e=>{e.hasAttribute(ATTRIBUTE_INPUT_FORMATTED)?this.savedDate?e.setAttribute("value",this.savedDate?.toLocaleString("ru",{year:"numeric",month:"long",day:"numeric"})):e.setAttribute("value",""):this.savedDate?e.setAttribute("value",a):e.setAttribute("value","");var t=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)})};getPanel=({year:t,month:a})=>{var n=[],T=[];let r=new Date(t,a,1).getDay();0===r&&(r=7);for(let e=-1*(r-=2);e<=0;e++){var i=new Date(t,a,e);n.push(i)}var l=42-r;for(let e=1;e<l;e++){var A=new Date(t,a,e);n.push(A)}for(let e=0;e<n.length;e+=7)T.push(n.slice(e,e+7));return T}}export{Calendar as inputCalendar,CalendarHead as inputCalendarHead,CalendarTable as inputCalendarTable};
//# sourceMappingURL=index.min.js.map
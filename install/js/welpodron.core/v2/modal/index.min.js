import{animate}from"../animate/index.js";const modalsListActive=new Set,MODULE_BASE="modal",ATTRIBUTE_BASE="data-w-"+MODULE_BASE,ATTRIBUTE_BASE_ID=ATTRIBUTE_BASE+"-id",ATTRIBUTE_BASE_ACTIVE=ATTRIBUTE_BASE+"-active",ATTRIBUTE_BASE_ONCE=ATTRIBUTE_BASE+"-once",ATTRIBUTE_CONTENT=ATTRIBUTE_BASE+"-content",ATTRIBUTE_CONTROL=ATTRIBUTE_BASE+"-control",ATTRIBUTE_ACTION=ATTRIBUTE_BASE+"-action",ATTRIBUTE_ACTION_ARGS=ATTRIBUTE_ACTION+"-args",ATTRIBUTE_ACTION_FLUSH=ATTRIBUTE_ACTION+"-flush",DEFAULT_EVENT_CLICK="click",DEFAULT_EVENT_KEYDOWN="keydown";class Modal{spAc=["hide","show"];el;lFdE;fFE;lFeE;isTr=!1;isAc=!1;isOnce=!1;constructor({element:t,config:e={}}){this.el=t,null!=e.isOnce?this.isOnce=e.isOnce:this.isOnce=null!=this.el.getAttribute(ATTRIBUTE_BASE_ONCE),this.isAc=null!=this.el.getAttribute(ATTRIBUTE_BASE_ACTIVE),this.lFdE=document.activeElement,this.fFE=document.createElement("div"),this.fFE.setAttribute(ATTRIBUTE_CONTENT,""),this.fFE.tabIndex=0,this.lFeE=document.createElement("button"),this.lFeE.style.cssText="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0;",this.lFeE.onfocus=()=>this.fFE.focus(),this.fFE.append(...this.el.childNodes),this.el.append(this.fFE),this.el.append(this.lFeE),document.addEventListener(DEFAULT_EVENT_CLICK,this.hDC)}hDC=t=>{let e=t["target"];var i,s;if(e)return e===this.el?this.hide({event:t}):(e=e.closest(`[${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"][${ATTRIBUTE_CONTROL}][${ATTRIBUTE_ACTION}]`))&&(s=e.getAttribute(ATTRIBUTE_ACTION),i=e.getAttribute(ATTRIBUTE_ACTION_ARGS),e.getAttribute(ATTRIBUTE_ACTION_FLUSH)||t.preventDefault(),s)&&this.spAc.includes(s)&&(s=this[s])instanceof Function?(this.el.contains(e)||(this.lFdE=e),s({args:i,event:t})):void 0};hDKD=t=>{if("Tab"===t.code&&t.shiftKey)return t.target===this.fFE?(t.preventDefault(),this.lFeE.focus()):void 0;var e;"Escape"===t.key&&modalsListActive.size&&!(e=[...modalsListActive][modalsListActive.size-1]).isTr&&e.hide({event:t})};show=async({}={})=>{this.isTr||this.isAc||(this.el.parentNode&&document.body.append(this.el),this.isTr=!0,document.body.style.overflow="hidden",document.body.style.touchAction="pinch-zoom",this.el.style.display="flex",this.el.scrollHeight,this.el.style.inset="",await animate({element:this.el,callback:()=>{this.el.setAttribute(ATTRIBUTE_BASE_ACTIVE,"")}}).promise,document.addEventListener(DEFAULT_EVENT_KEYDOWN,this.hDKD),this.fFE.focus(),modalsListActive.add(this),this.isTr=!1,this.isAc=!0)};hide=async({}={})=>{var t;!this.isTr&&this.isAc&&(this.isTr=!0,await animate({element:this.el,callback:()=>{this.el.removeAttribute(ATTRIBUTE_BASE_ACTIVE)}}).promise,this.el.style.display="none",modalsListActive.delete(this),modalsListActive.size||(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("touch-action")),document.removeEventListener(DEFAULT_EVENT_KEYDOWN,this.hDKD),this.lFdE?.focus(),document.activeElement!==this.lFdE&&modalsListActive.size&&(t=[...modalsListActive].pop())&&t.fFE.focus(),this.isOnce&&(document.removeEventListener(DEFAULT_EVENT_CLICK,this.hDC),this.el.remove()),this.isTr=!1,this.isAc=!1)}}export{Modal as modal,modalsListActive};
//# sourceMappingURL=index.min.js.map
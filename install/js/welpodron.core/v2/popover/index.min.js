const MODULE_BASE="popover",ATTRIBUTE_BASE="data-w-"+MODULE_BASE,ATTRIBUTE_BASE_ID=ATTRIBUTE_BASE+"-id",ATTRIBUTE_BASE_ACTIVE=ATTRIBUTE_BASE+"-active",ATTRIBUTE_BASE_HOVERABLE=ATTRIBUTE_BASE+"-hoverable",ATTRIBUTE_CONTROL=ATTRIBUTE_BASE+"-control",ATTRIBUTE_ACTION=ATTRIBUTE_BASE+"-action",ATTRIBUTE_ACTION_ARGS=ATTRIBUTE_ACTION+"-args",ATTRIBUTE_ACTION_FLUSH=ATTRIBUTE_ACTION+"-flush";class Popover{spAc=["hide","show"];isHoverable=!1;hoverableLeaveTimeout=null;isAc=!1;el;lFdE;resizeObserver;currentAnchor;constructor({element:e,config:t={}}){this.el=e,this.isAc=null!=this.el.getAttribute(ATTRIBUTE_BASE_ACTIVE),this.isHoverable=null!=this.el.getAttribute(ATTRIBUTE_BASE_HOVERABLE)||!0===t.isHoverable,this.lFdE=document.activeElement,this.resizeObserver=new ResizeObserver((e,t)=>{for(const i of e)this.currentAnchor&&this.calculatePosition({anchor:this.currentAnchor})}),this.isHoverable?(document.removeEventListener("mouseover",this.handleDocumentMouseOver),document.addEventListener("mouseover",this.handleDocumentMouseOver),document.removeEventListener("mouseout",this.handleDocumentMouseOut),document.addEventListener("mouseout",this.handleDocumentMouseOut)):(document.removeEventListener("click",this.hDC),document.addEventListener("click",this.hDC))}calculatePosition=({anchor:e})=>{var{width:e,height:t,left:i,top:s}=e.getBoundingClientRect(),t=(this.el.style.left=i+window.scrollX+"px",this.el.style.top=s+t+window.scrollY+"px",document.documentElement.clientHeight),T=document.documentElement.clientWidth,{width:n,height:o,left:r,top:A}=this.el.getBoundingClientRect();Math.ceil(r+n)>=T&&(this.el.style.left=i+window.scrollX-n+e+"px"),Math.ceil(A+o)>=t&&(this.el.style.top=s+window.scrollY-o+"px")};show=async({event:t})=>{var e;!this.isAc&&(document.body.append(this.el),e=[...document.querySelectorAll(`[${ATTRIBUTE_CONTROL}][${ATTRIBUTE_ACTION}][${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"]:not([${ATTRIBUTE_BASE}][${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"] *)`)].find(e=>e.contains(t?.target)))&&(this.currentAnchor=e,this.resizeObserver.observe(this.el),this.resizeObserver.observe(e),document.removeEventListener("keydown",this.hDKD),document.addEventListener("keydown",this.hDKD),window.removeEventListener("resize",this.handleWindowResize),window.addEventListener("resize",this.handleWindowResize),this.el.setAttribute(ATTRIBUTE_BASE_ACTIVE,""),this.calculatePosition({anchor:e}),this.isAc=!0)};hide=async({}={})=>{this.isAc&&(this.resizeObserver.disconnect(),document.removeEventListener("keydown",this.hDKD),this.lFdE?.focus(),this.el.removeAttribute(ATTRIBUTE_BASE_ACTIVE),this.isAc=!1)};hDKD=e=>{if("Escape"===e.key)return this.hide({event:e})};handleWindowResize=e=>{this.isAc&&this.calculatePosition({anchor:this.currentAnchor})};hDC=e=>{var t,i,s=e["target"];if(s)return s.closest(`[${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"][${ATTRIBUTE_CONTROL}][${ATTRIBUTE_ACTION}]`)?(i=s.getAttribute(ATTRIBUTE_ACTION),t=s.getAttribute(ATTRIBUTE_ACTION_ARGS),s.getAttribute(ATTRIBUTE_ACTION_FLUSH)||e.preventDefault(),i&&this.spAc.includes(i)&&(i=this[i])instanceof Function?(this.el.contains(s)||(this.lFdE=s),i({args:t,event:e})):void 0):document.contains(s)&&!this.el.contains(s)?this.hide({event:e}):void 0};handleDocumentMouseOver=async e=>{var t=e["target"];if(t){var i,s,t=t.closest(`[${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"][${ATTRIBUTE_CONTROL}][${ATTRIBUTE_ACTION}]`);if(t)return null!=this.hoverableLeaveTimeout&&clearTimeout(this.hoverableLeaveTimeout),s=t.getAttribute(ATTRIBUTE_ACTION),i=t.getAttribute(ATTRIBUTE_ACTION_ARGS),t.getAttribute(ATTRIBUTE_ACTION_FLUSH)||e.preventDefault(),s&&this.spAc.includes(s)&&(s=this[s])instanceof Function?(this.el.contains(t)||(this.lFdE=t),s({args:i,event:e})):void 0}};handleDocumentMouseOut=async e=>{let t=e["relatedTarget"];null!=this.hoverableLeaveTimeout&&clearTimeout(this.hoverableLeaveTimeout),this.hoverableLeaveTimeout=setTimeout(()=>t&&this.el.contains(t)?void 0:this.hide({}),125)}}export{Popover as popover};
//# sourceMappingURL=index.min.js.map
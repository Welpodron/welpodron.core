import{animate}from"../animate/index.js";const MODULE_BASE="carousel",ATTRIBUTE_BASE="data-w-"+MODULE_BASE,ATTRIBUTE_BASE_ID=ATTRIBUTE_BASE+"-id",ATTRIBUTE_ITEM=ATTRIBUTE_BASE+"-item",ATTRIBUTE_ITEM_ID=ATTRIBUTE_ITEM+"-id",ATTRIBUTE_ITEM_ACTIVE=ATTRIBUTE_ITEM+"-active",ATTRIBUTE_ITEM_TRANSLATING_FROM_LEFT=ATTRIBUTE_ITEM+"-translating-from-left",ATTRIBUTE_ITEM_TRANSLATING_FROM_RIGHT=ATTRIBUTE_ITEM+"-translating-from-right",ATTRIBUTE_ITEM_TRANSLATING_TO_LEFT=ATTRIBUTE_ITEM+"-translating-to-left",ATTRIBUTE_ITEM_TRANSLATING_TO_RIGHT=ATTRIBUTE_ITEM+"-translating-to-right",ATTRIBUTE_CONTROL=ATTRIBUTE_BASE+"-control",ATTRIBUTE_CONTROL_ACTIVE=ATTRIBUTE_CONTROL+"-active",ATTRIBUTE_ACTION=ATTRIBUTE_BASE+"-action",ATTRIBUTE_ACTION_ARGS=ATTRIBUTE_ACTION+"-args",ATTRIBUTE_ACTION_FLUSH=ATTRIBUTE_ACTION+"-flush",DEFAULT_EVENT_TOUCHSTART="touchstart",DEFAULT_EVENT_TOUCHMOVE="touchmove",DEFAULT_EVENT_TOUCHEND="touchend",DEFAULT_EVENT_CLICK="click";class CarouselItem{spAc=["hide","show"];carousel;el;an=null;constructor({element:t,carousel:T}){this.el=t,this.carousel=T}show=async({args:t})=>{this.an&&clearTimeout(this.an.timer),null==this.el.getAttribute(ATTRIBUTE_ITEM_ACTIVE)&&("right"===t?this.el.setAttribute(ATTRIBUTE_ITEM_TRANSLATING_FROM_LEFT,""):"left"===t&&this.el.setAttribute(ATTRIBUTE_ITEM_TRANSLATING_FROM_RIGHT,""),this.el.setAttribute(ATTRIBUTE_ITEM_ACTIVE,""),document.querySelectorAll(`[${ATTRIBUTE_ACTION_ARGS}="${this.el.getAttribute(""+ATTRIBUTE_ITEM_ID)}"][${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"][${ATTRIBUTE_CONTROL}]`).forEach(t=>{t.setAttribute(ATTRIBUTE_CONTROL_ACTIVE,"")}),this.el.scrollHeight,this.an=animate({element:this.el,callback:()=>{"right"===t?this.el.removeAttribute(ATTRIBUTE_ITEM_TRANSLATING_FROM_LEFT):"left"===t&&this.el.removeAttribute(ATTRIBUTE_ITEM_TRANSLATING_FROM_RIGHT)}}),await this.an?.promise,this.an=null)};hide=async({args:t})=>{this.an&&clearTimeout(this.an.timer),null!=this.el.getAttribute(ATTRIBUTE_ITEM_ACTIVE)&&(this.el.style.display="block",this.an=animate({element:this.el,callback:()=>{"right"===t?this.el.setAttribute(ATTRIBUTE_ITEM_TRANSLATING_TO_RIGHT,""):"left"===t&&this.el.setAttribute(ATTRIBUTE_ITEM_TRANSLATING_TO_LEFT,""),this.el.removeAttribute(ATTRIBUTE_ITEM_ACTIVE),document.querySelectorAll(`[${ATTRIBUTE_ACTION_ARGS}="${this.el.getAttribute(""+ATTRIBUTE_ITEM_ID)}"][${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"][${ATTRIBUTE_CONTROL}]`).forEach(t=>{t.removeAttribute(ATTRIBUTE_CONTROL_ACTIVE)})}}),await this.an?.promise,this.el.style.removeProperty("display"),"right"===t?this.el.removeAttribute(ATTRIBUTE_ITEM_TRANSLATING_TO_RIGHT):"left"===t&&this.el.removeAttribute(ATTRIBUTE_ITEM_TRANSLATING_TO_LEFT),this.an=null)}}class Carousel{spAc=["show"];element;tSX=0;tDX=0;sTh=45;items=[];cItIn=-1;nItIn=-1;constructor({element:t}){this.el=t,document.addEventListener(DEFAULT_EVENT_CLICK,this.hDC),this.el.addEventListener(DEFAULT_EVENT_TOUCHSTART,this.hETS,{passive:!0})}hDC=t=>{let T=t["target"];var e,I;if(T&&(T=T.closest(`[${ATTRIBUTE_BASE_ID}="${this.el.getAttribute(""+ATTRIBUTE_BASE_ID)}"][${ATTRIBUTE_CONTROL}][${ATTRIBUTE_ACTION}]`)))return I=T.getAttribute(ATTRIBUTE_ACTION),e=T.getAttribute(ATTRIBUTE_ACTION_ARGS),T.getAttribute(ATTRIBUTE_ACTION_FLUSH)||t.preventDefault(),I&&this.spAc.includes(I)&&(I=this[I])instanceof Function?I({args:e,event:t}):void 0};hETS=t=>{this.el.addEventListener(DEFAULT_EVENT_TOUCHEND,this.hETE,{once:!0}),this.el.addEventListener(DEFAULT_EVENT_TOUCHMOVE,this.hETM),this.tSX=t.touches[0].clientX};hETM=t=>{this.tDX=t.touches&&1<t.touches.length?0:t.touches[0].clientX-this.tSX};hETE=t=>{this.el.removeEventListener(DEFAULT_EVENT_TOUCHMOVE,this.hETM);var T=Math.abs(this.tDX);T>this.sTh&&this.show({args:T/this.tDX<0?"next":"prev",event:t}),this.tDX=0};gNIt=async({index:T})=>{this.its&&(-1===this.cItIn&&(this.cItIn=this.its.findIndex(t=>null!=t.element.getAttribute(ATTRIBUTE_ITEM_ACTIVE))),-1!==this.cItIn)&&(this.nItIn="next"===T?(this.cItIn+1)%this.its.length:"prev"===T?(this.cItIn+this.its.length-1)%this.its.length:this.its.findIndex(t=>t.element.getAttribute(ATTRIBUTE_ITEM_ID)===T))};gNDi=async()=>{var t;if(-1!==this.nItIn&&-1!==this.cItIn&&this.nItIn!==this.cItIn)return t=this.its.length-1,(this.nItIn!==t||0!==this.cItIn)&&(0===this.nItIn&&this.cItIn===t||this.nItIn>this.cItIn)?"left":"right"};show=async({args:t,event:T})=>{if(t){var e=this.el.getAttribute(ATTRIBUTE_BASE_ID);if(e){e=this.el.querySelectorAll(`[${ATTRIBUTE_BASE_ID}="${e}"][${ATTRIBUTE_ITEM_ID}]`);if(e){for(var I of this.its)I.an&&(clearTimeout(I.an.timer),I.an.promise.resolve());if(this.its=[...e].map(t=>new CarouselItem({element:t,carousel:this})),await this.gNIt({index:t}),-1!==this.nItIn&&-1!==this.cItIn){var i=await this.gNDi();if(i){var s=[];for(let t=0;t<this.its.length;t++){var E=this.its[t];t!==this.cItIn&&t===this.nItIn?s.push(E.show({args:i,event:T})):s.push(E.hide({args:i,event:T}))}this.cItIn=this.nItIn,await Promise.allSettled(s)}}}}}}}export{Carousel as carousel,CarouselItem as carouselItem};
//# sourceMappingURL=index.min.js.map